/*!
* Vulidate.js v0.1.0
* (c) 2018 张帅
* Released under the MIT License.
*/!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.vulidate={})}(this,function(t){"use strict";var e={name:"vul-form",props:{value:Object,rules:Object},provide:function(){return{form:{rules:this.rules,value:this.value,register:this.register,unregister:this.unregister}}},created:function(){this.formItems=[]},render:function(t,e){return t("form",{attrs:{novalidate:!0},nativeOn:{submit:function(t){return t.preventDefault()}}},e.children)},methods:{validate:function(){if((0<arguments.length&&void 0!==arguments[0]?arguments[0]:{firstField:!1}).firstField)return Promise.resolve(this.formItems.every(function(t){return t.validate()}));var r=!0;return this.formItems.forEach(function(t){var e=t.validate();r&&(r=e)}),Promise.resolve(r)},validateAndScroll:function(){var e=this;return this.validate.apply(this,arguments).then(function(t){return t||e.formItems.every(function(t){return t.valid||(t.$el.scrollIntoViewIfNeeded(),"function"==typeof t.invalidInput.focus&&t.invalidInput.focus()),t.valid}),t})},register:function(t){this.formItems.push(t)},unregister:function(t){this.formItems.splice(this.formItems.indexOf(t),1)}}},r=/^(\+?0?86-?)?1[3456789]\d{9}$/,i=/^(0[0-9]{2,3}-)?([1-9][0-9]{6,7})+(-[0-9]{1,4})?$/;var u=Object.freeze({cnmobileCheck:function(t){return r.test(t)},cnnameCheck:function(t){return/^[*\u4E00-\u9FA5]{1,8}(?:[·•]{1}[\u4E00-\u9FA5]{2,10})*$/.test(t)},fixedtelCheck:function(t){return i.test(t)},bankcardCheck:function(t){var e=(t=(""+t).replace(/\s/gi,"")).length;if(!/\d+/.test(t)||e<9)return!1;t=t.split("");for(var r=parseInt(t[e-1]),i=0,n=e-2,s=0;0<=n;n--,s++){var u=parseInt(t[n]);s%2==0&&(u*=2,u=parseInt(u/10)+parseInt(u%10)),i+=parseInt(u)}return(i+r)%10==0},idCardCheck:function(t){if(/^\d{17}[0-9xX]$/.test(t)){for(var e="1,0,x,9,8,7,6,5,4,3,2".split(","),r="7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2".split(","),i=t.toLowerCase().split(""),n=0,s=0;s<17;s++)n+=r[s]*i[s];return e[n%11]===i[17]}},passwordCheck:function(t){return 6<(t+="").length&&/\d+/.test(t)&&/[a-z]+/.test(t)},smsCodeCheck:function(t){return/[0-9]{4,6}/.test(t)}}),o={BLUR:"vul.blur",FOCUS:"vul.focus",CHANGE:"vul.change"},n={name:"vul-form-item",provide:function(){return{formItem:{register:this.register,unregister:this.unregister}}},inject:{form:{default:null}},props:{label:String,rules:[Array,Object],prop:String},created:function(){this.inputs=[],this.form&&this.form&&this.form.register(this)},beforeDestroy:function(){this.form&&this.form.unregister(this)},data:function(){return{valid:!0,focusd:!0,validMessage:"",invalidInput:null}},computed:{allRules:function(){return this.rules||this.form&&this.form.rules&&this.form.rules[this.prop]||[]},isMultipart:function(){return 1<this.inputs.length},fixedValue:function(){return this.form&&this.form.value&&this.form.value[this.prop]}},render:function(t){var e=this.label;return t("div",{staticClass:"vul-form-item",class:{error:!this.valid}},[e?t("label",{staticClass:"vul-form-item-label"},e):null,this.$slots.default,t("span",{staticClass:"vul-form-item-message"},this.validMessage)])},methods:{validate:function(r){var i=this;return this.valid=this.inputs.every(function(t){var e=i.validateItem(r,t);return e||(i.invalidInput=t),e}),this.valid},validateItem:function(t){var r=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this.getFilterRules(t,e.prop),n=!0;if(!i||!i.length)return!0;var s=this.fixedValue;if(this.isMultipart){if(!s)throw new Error("formItem multipart value is not a object");s=s[e.prop]}return i.every(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(t.required&&(null==s||""===s||Array.isArray(s)&&!s.length))n=!1;else if(t.fn)if("string"==typeof t.fn){var e=t.fn+"Check";if(!(e in u))throw new Error(e+"无此校验函数");n=u[e](s)}else n=t.fn(s);else n=!0;return r.validMessage=t&&t.message,n})},validateOptionHandler:function(t){var r=this;t.unBindTriggerWatchers&&t.unBindTriggerWatchers();var e=function(e){r.valid=r.inputs.slice(0,r.inputs.indexOf(t)+1).every(function(t){return r.validateItem(e,t)})},i=function(){r.focusd=!1,e.call(r,"blur")},n=function(){r.focusd?e.call(r,"change"):e.call(r,"blur")},s=function(){r.focusd=!0};t.$on(o.BLUR,i),t.$on(o.FOCUS,s),t.$on(o.CHANGE,n),t.unBindTriggerWatchers=function(){t.$off(o.BLUR,i),t.$off(o.FOCUS,s),t.$off(o.CHANGE,n)}},getFilterRules:function(e,t){var r=this.allRules;return this.isMultipart&&(r=r[t]||[]),Array.isArray(r)?e?r.filter(function(t){return!t.trigger||t.trigger===e}):r:[r]},register:function(t){this.validateOptionHandler(t),this.inputs.push(t)},unregister:function(t){t.unBindTriggerWatchers&&t.unBindTriggerWatchers(),this.inputs.splice(this.inputs.indexOf(t),1)}}};function s(){}function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;return{name:"vul-validatable",inject:{formItem:{default:null}},props:{prop:String},mounted:function(){t.call(this,o),this.formItem&&this.formItem.register(this)},destroyed:function(){this.formItem&&this.formItem.unregister(this)}}}t.VulForm=e,t.VulFormItem=n,t.install=function(t){t.component(e.name,e),t.component(n.name,n)},t.createValidatable=a,t.ACTIONS=o,t.mixinValidatable=function(t,e){return t.mixins=t.mixins||[],t.mixins.push(a(e)),t},Object.defineProperty(t,"__esModule",{value:!0})});