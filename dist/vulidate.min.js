/*!
* Vulidate.js v0.1.0
* (c) 2018 张帅
* Released under the MIT License.
*/!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vulidate={})}(this,function(e){"use strict";var t={name:"vul-form",props:{value:Object,rules:Object},provide:function(){return{form:this}},created:function(){this.formItems=[]},render:function(e){return e("form",{attrs:{novalidate:!0},nativeOn:{submit:function(e){return e.preventDefault()}}},this.$slots.default)},computed:{resolvedRules:function(){return this.rules||this.value&&this.value.__rules}},methods:{validate:function(){var o=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{trigger:null,firstField:!1},u=e.trigger;return e.firstField?Promise.all(this.formItems.map(function(e){return e.validate(u)})):new Promise(function(e,t){var r=[],n=0,i=o.formItems.length;function s(){++n===i&&(r.length?t(r):e())}o.formItems.forEach(function(e){e.validate(u).then(s).catch(function(e){r.push(e),s()})})})},validateAndScroll:function(){var t=this;return this.validate.apply(this,arguments).then(function(e){return e||t.formItems.every(function(e){return e.valid||(e.$el.scrollIntoViewIfNeeded(),"function"==typeof e.invalidInput.focus&&e.invalidInput.focus()),e.valid}),e})},register:function(e){this.formItems.push(e)},unregister:function(e){this.formItems.splice(this.formItems.indexOf(e),1)}}},r=/^(\+?0?86-?)?1[3456789]\d{9}$/,n=/^(0[0-9]{2,3}-)?([1-9][0-9]{6,7})+(-[0-9]{1,4})?$/;var o={cnmobile:function(e){return r.test(e)},cnname:function(e){return/^[*\u4E00-\u9FA5]{1,8}(?:[·•]{1}[\u4E00-\u9FA5]{2,10})*$/.test(e)},fixedtel:function(e){return n.test(e)},bankcard:function(e){var t=(e=(""+e).replace(/\s/gi,"")).length;if(!/\d+/.test(e)||t<9)return!1;e=e.split("");for(var r=parseInt(e[t-1]),n=0,i=t-2,s=0;0<=i;i--,s++){var o=parseInt(e[i]);s%2==0&&(o*=2,o=parseInt(o/10)+parseInt(o%10)),n+=parseInt(o)}return(n+r)%10==0},idCard:function(e){if(/^\d{17}[0-9xX]$/.test(e)){for(var t="1,0,x,9,8,7,6,5,4,3,2".split(","),r="7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2".split(","),n=e.toLowerCase().split(""),i=0,s=0;s<17;s++)i+=r[s]*n[s];return t[i%11]===n[17]}}};var u={BLUR:"vul.blur",FOCUS:"vul.focus",CHANGE:"vul.change"};function i(){}function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i;return{name:"vul-validatable",inject:{formItem:{default:null}},props:{prop:String},mounted:function(){e.call(this,u),this.formItem&&this.formItem.register(this)},destroyed:function(){this.formItem&&this.formItem.unregister(this)}}}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function c(u,l){var a=this;return"object"===(void 0===u?"undefined":f(u))&&null!==u?new Promise(function(e,t){var r=Object.keys(u),n=[],i=0,s=a.formItems.length;function o(){++i===s&&(n.length?t(n):e())}r.forEach(function(e){c(u[e],l[e]).then(o).catch(function(e){return n.push(e),o(),Promise.reject(e)})})}):Array.isArray(u)&&u.length?u.slice(1).reduce(function(e,t){return e.then(function(){d(t,l)})},d(u[0],l)):Promise.reject(new Error("rules type should be object or array"))}function d(e,t){var r=void 0;if(e.required&&(null==t||""===t||Array.isArray(t)&&!t.length))r=!1;else if(e.fn)if("string"==typeof e.fn){var n=e.fn;if(!(n in o))throw new Error("not define "+n+" in validator");r=o[n](t)}else r=e.fn(t);else r=!0;return r.then?r:r?Promise.resolve():Promise.reject(Object.assign({},e))}var l={name:"vul-form-item",provide:function(){return{formItem:{register:this.register,unregister:this.unregister}}},inject:{form:{default:null}},props:{label:String,rules:[Array,Object],prop:String},created:function(){this.inputs=[],this.form&&this.form&&this.form.register(this)},beforeDestroy:function(){this.form&&this.form.unregister(this)},data:function(){return{valid:!0,focusd:!0,validMessage:"",invalidInput:null}},computed:{allRules:function(){var e=this.form&&this.form.value;return this.rules||this.form&&this.form.rules&&this.form.rules[this.prop]||e&&e.__rules&&e.__rules[this.prop]||e&&e[this.prop]&&e[this.prop].__rules||[]},fixedValue:function(){var e=this.form&&this.form.value||{};return this.prop?e[this.prop]:e}},render:function(e){var t=this.label;return e("div",{staticClass:"vul-form-item",class:{error:!this.valid}},[t?e("label",{staticClass:"vul-form-item-label"},t):null,this.$slots.default,e("span",{staticClass:"vul-form-item-message",directives:[{name:"show",value:!this.valid,expression:"!valid"}]},this.validMessage)])},methods:{validate:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=this.getFilterRules(e,r.prop);return n?c(n,this.fixedValue).then(function(){t.valid=!0}).catch(function(e){return t.valid=!1,t.validMessage=e.message,Promise.reject(e)}):Promise.resolve()},validateOptionHandler:function(e){var r=this;e.unBindTriggerWatchers&&e.unBindTriggerWatchers();var t=function(t){r.valid=r.inputs.slice(0,r.inputs.indexOf(e)+1).every(function(e){return r.validate(t,e)})},n=function(){r.focusd=!1,t.call(r,"blur")},i=function(){r.focusd?t.call(r,"change"):t.call(r,"blur")},s=function(){r.focusd=!0};e.$on(u.BLUR,n),e.$on(u.FOCUS,s),e.$on(u.CHANGE,i),e.unBindTriggerWatchers=function(){e.$off(u.BLUR,n),e.$off(u.FOCUS,s),e.$off(u.CHANGE,i)}},getFilterRules:function(t,e){var r=this.allRules;return e&&(r=r[e]||[]),Array.isArray(r)?t?r.filter(function(e){return!e.trigger||e.trigger===t}):r:[r]},register:function(e){this.validateOptionHandler(e),this.inputs.push(e)},unregister:function(e){e.unBindTriggerWatchers&&e.unBindTriggerWatchers(),this.inputs.splice(this.inputs.indexOf(e),1)}}},a={};["required"].concat(Object.keys(o)).forEach(function(e){var s;a[e]=(s=e,function(){var n=arguments[0]||"valid fail",i=arguments[1];return function(u,e,t){u.__rules||(Object.defineProperty(u,"__rules",{enumerable:!1,configurable:!1,writable:!0,value:Object.create(null)}),Object.defineProperty(u,"$validate",{enumerable:!1,configurable:!1,writable:!1,value:function(){return new Promise(function(e,t){var r=Object.keys(u),n=r.filter(function(e){var t=u[e].$validate;return t&&t().then(o).catch(function(e){s.push(e),o()}),!!t}).length+1,i=0,s=[];function o(){++i===n&&(s.length?t(s):e())}c(u,u.__rules).then(o).catch(function(e){s.push(e),o()})})}}));var r={message:n};"required"===s?r.required=!0:r.fn=o[s],i&&(r.trigger=i),u.__rules[e]?u.__rules[e].push(r):u.__rules[e]=[r]}})}),e.VulForm=t,e.VulFormItem=l,e.install=function(e){e.component(t.name,t),e.component(l.name,l)},e.createValidatable=s,e.ACTIONS=u,e.registValidator=function(e){o[e.name]=e},e.decorators=a,e.mixinValidatable=function(e,t){return e.mixins=e.mixins||[],e.mixins.push(s(t)),e},e.validate=c,Object.defineProperty(e,"__esModule",{value:!0})});